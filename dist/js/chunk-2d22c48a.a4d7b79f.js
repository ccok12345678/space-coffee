(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d22c48a"],{f329:function(e,t,o){"use strict";o.r(t);var n=o("7a23"),c=Object(n["createElementVNode"])("i",{class:"bi bi-file-earmark-plus"},null,-1),a=[c],l={key:0,class:"w-100 overflow-auto text-nowrap text-center"},r={class:"table table-sm table-light table-striped table-hover align-middle"},i=Object(n["createElementVNode"])("thead",null,[Object(n["createElementVNode"])("tr",null,[Object(n["createElementVNode"])("th",null,[Object(n["createTextVNode"])("名稱"),Object(n["createElementVNode"])("i",{class:"bi bi-pencil-square ms-2"})]),Object(n["createElementVNode"])("th",null,"代碼"),Object(n["createElementVNode"])("th",null,"折數"),Object(n["createElementVNode"])("th",null,"到期日"),Object(n["createElementVNode"])("th",null,"啟用"),Object(n["createElementVNode"])("th")])],-1),s=["onClick"],d={class:"form-switch text-center"},u=["onUpdate:modelValue","onChange"],p=["onClick"],b=Object(n["createElementVNode"])("i",{class:"bi bi-pencil-square"},null,-1),m=[b],h=["onClick"],j=Object(n["createElementVNode"])("i",{class:"bi bi-trash"},null,-1),O=[j];function f(e,t,o,c,b,j){var f=Object(n["resolveComponent"])("Pagination"),V=Object(n["resolveComponent"])("CouponModal"),E=Object(n["resolveComponent"])("DeleteModal"),v=Object(n["resolveComponent"])("VueLoading");return Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],null,[Object(n["createElementVNode"])("a",{class:"btn btn-secondary btn-fixed fs-3 hover-half-transparent text-light border-0",title:"新增優惠卷",onClick:t[0]||(t[0]=Object(n["withModifiers"])((function(e){return j.openModal(!0)}),["prevent"]))},a),b.coupons.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("section",l,[Object(n["createElementVNode"])("table",r,[i,Object(n["createElementVNode"])("tbody",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(b.coupons,(function(t){return Object(n["openBlock"])(),Object(n["createElementBlock"])("tr",{key:t.id},[Object(n["createElementVNode"])("td",null,[Object(n["createElementVNode"])("a",{class:"link-dark text-decoration-none",href:"#",onClick:Object(n["withModifiers"])((function(e){return j.openModal(!1,t)}),["prevent"])},Object(n["toDisplayString"])(t.title),9,s)]),Object(n["createElementVNode"])("td",null,Object(n["toDisplayString"])(t.code),1),Object(n["createElementVNode"])("td",null,Object(n["toDisplayString"])(t.percent/10)+"折",1),Object(n["createElementVNode"])("td",null,Object(n["toDisplayString"])(e.$filters.date(t.due_date)),1),Object(n["createElementVNode"])("td",null,[Object(n["createElementVNode"])("div",d,[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{class:"form-check-input me-0 p-2 shadow-0",id:"productEnabled",type:"checkbox",role:"switch","onUpdate:modelValue":function(e){return t.is_enabled=e},"true-value":1,"false-value":0,onChange:Object(n["withModifiers"])((function(e){return j.updateCoupon(t)}),["prevent"])},null,40,u),[[n["vModelCheckbox"],t.is_enabled]])])]),Object(n["createElementVNode"])("td",null,[Object(n["createElementVNode"])("button",{class:"border-0 hover-gray py-2 d-block w-100",type:"button",title:"編輯",onClick:Object(n["withModifiers"])((function(e){return j.openModal(!1,t)}),["prevent"])},m,8,p),Object(n["createElementVNode"])("button",{class:"border-0 hover-red py-2 d-block w-100",type:"button",title:"刪除",onClick:Object(n["withModifiers"])((function(e){return j.checkDelete(t)}),["prevent"])},O,8,h)])])})),128))])])])):Object(n["createCommentVNode"])("",!0),Object(n["createVNode"])(f,{pages:b.pagination,onEmitPage:j.getCoupons},null,8,["pages","onEmitPage"]),Object(n["createVNode"])(V,{ref:"couponModal",coupon:b.tempCoupon,onEmitCoupon:j.updateCoupon},null,8,["coupon","onEmitCoupon"]),Object(n["createVNode"])(E,{ref:"deleteModal",item:b.tempCoupon,itemClass:"優惠卷",onEmitDelete:j.delCoupon},null,8,["item","onEmitDelete"]),Object(n["createVNode"])(v,{active:b.isLoading},null,8,["active"])],64)}var V=o("5530"),E=o("1da1"),v=(o("96cf"),o("99af"),o("d3b7"),o("e9c4"),o("1799")),N={class:"modal fade",id:"modal_product",tabindex:"-1",ref:"modal"},g={class:"modal-dialog modal-dialog-centered"},k=Object(n["createElementVNode"])("div",{class:"modal-header p-2 mb-3"},[Object(n["createElementVNode"])("h5",{class:"modal-title"},"編輯優惠卷"),Object(n["createElementVNode"])("button",{class:"btn-close",type:"button","data-bs-dismiss":"modal","aria-label":"Close"})],-1),w={class:"modal-body"},C={class:"row"},x=Object(n["createElementVNode"])("label",{class:"col-3 col-form-label py-1",for:"couponName"},"優惠卷：",-1),y={class:"col-9 mb-2"},M=Object(n["createElementVNode"])("label",{class:"col-3 col-form-label py-1",for:"couponCode"},"優惠碼：",-1),_={class:"col-9 mb-2"},D=Object(n["createElementVNode"])("div",{class:"w-100"},null,-1),B=Object(n["createElementVNode"])("label",{class:"col-3 col-form-label py-1",for:"couponDueDate"},"到期日：",-1),T={class:"col mb-2"},P=Object(n["createElementVNode"])("div",{class:"w-100"},null,-1),S=Object(n["createElementVNode"])("label",{class:"col-3 col-form-label py-1",for:"couponPercent"},"折數：",-1),U={class:"col-6 mb-2"},q={class:"input-group"},L=Object(n["createElementVNode"])("span",{class:"input-group-text"},"折",-1),R=Object(n["createElementVNode"])("div",{class:"w-100"},null,-1),$=Object(n["createElementVNode"])("div",{class:"col-3 py-1"},"啟用：",-1),z={class:"col-6 text-center"},A={class:"form-switch py-1"},I={class:"form-label",for:"couponIsEnabled"},J={key:0,class:"text-success"},F={key:1,class:"text-danger"},G=Object(n["createElementVNode"])("div",{class:"w-100"},null,-1),H=Object(n["createElementVNode"])("div",{class:"modal-footer p-0 pt-2 mt-3"},[Object(n["createElementVNode"])("button",{class:"btn btn-cyan-600 text-white w-30",type:"submit"},[Object(n["createElementVNode"])("i",{class:"bi bi-check-lg me-2"}),Object(n["createTextVNode"])("送出")]),Object(n["createElementVNode"])("button",{class:"btn btn-outline-gray-600 w-20",type:"button","data-bs-dismiss":"modal"},"取消")],-1);function K(e,t,o,c,a,l){return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",N,[Object(n["createElementVNode"])("div",g,[Object(n["createElementVNode"])("form",{class:"modal-content p-3",onSubmit:t[5]||(t[5]=Object(n["withModifiers"])((function(){return l.update&&l.update.apply(l,arguments)}),["prevent"]))},[k,Object(n["createElementVNode"])("div",w,[Object(n["createElementVNode"])("div",C,[x,Object(n["createElementVNode"])("div",y,[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{class:"form-control ps-2",id:"couponName",type:"text",required:"","onUpdate:modelValue":t[0]||(t[0]=function(e){return a.tempCoupon.title=e})},null,512),[[n["vModelText"],a.tempCoupon.title]])]),M,Object(n["createElementVNode"])("div",_,[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{class:"form-control ps-2",id:"couponCode",type:"text",required:"","onUpdate:modelValue":t[1]||(t[1]=function(e){return a.tempCoupon.code=e})},null,512),[[n["vModelText"],a.tempCoupon.code]])]),D,B,Object(n["createElementVNode"])("div",T,[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{class:"form-control ps-2",id:"couponDueDate",type:"date",required:"","onUpdate:modelValue":t[2]||(t[2]=function(e){return a.due_date=e})},null,512),[[n["vModelText"],a.due_date]])]),P,S,Object(n["createElementVNode"])("div",U,[Object(n["createElementVNode"])("div",q,[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{class:"form-control ps-2",id:"couponPercent",type:"number",min:"0.1",max:"9.9",step:"0.1","onUpdate:modelValue":t[3]||(t[3]=function(e){return a.discount=e}),required:""},null,512),[[n["vModelText"],a.discount]]),L])]),R,$,Object(n["createElementVNode"])("div",z,[Object(n["createElementVNode"])("div",A,[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{class:"form-check-input p-2 me-2",id:"couponIsEnabled",type:"checkbox",role:"switch","onUpdate:modelValue":t[4]||(t[4]=function(e){return a.is_enabled=e}),"true-value":1,"false-value":0},null,512),[[n["vModelCheckbox"],a.is_enabled]]),Object(n["createElementVNode"])("label",I,[a.is_enabled?(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",J,"啟用")):(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",F,"未啟用"))])])]),G])]),H],32)])],512)}var Q=o("3835"),W=(o("ac1f"),o("1276"),o("e0ae")),X={data:function(){return{tempCoupon:{},due_date:"",is_enabled:1,discount:.1}},mixins:[W["a"]],props:{coupon:{type:Object,default:function(){return{}}}},watch:{coupon:function(){if(this.tempCoupon=Object(V["a"])({},this.coupon),this.tempCoupon.due_date){var e=new Date(1e3*this.tempCoupon.due_date).toISOString().split("T"),t=Object(Q["a"])(e,1);this.due_date=t[0],this.is_enabled=this.tempCoupon.is_enabled,this.discount=this.tempCoupon.percent/10}else this.due_date="",this.is_enabled=0,this.discount=0},due_date:function(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},methods:{update:function(){this.tempCoupon.is_enabled=this.is_enabled,this.tempCoupon.percent=10*this.discount,this.$emit("emit-coupon",this.tempCoupon)}}},Y=o("6b0d"),Z=o.n(Y);const ee=Z()(X,[["render",K]]);var te=ee,oe=o("053c"),ne={data:function(){return{coupons:[],tempCoupon:{},pagination:{},currentPage:1,isNew:!1,isLoading:!1}},components:{Pagination:v["a"],CouponModal:te,DeleteModal:oe["a"]},inject:["tokenValue","pushToast"],methods:{getCoupons:function(){var e=arguments,t=this;return Object(E["a"])(regeneratorRuntime.mark((function o(){var n,c,a,l;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return n=e.length>0&&void 0!==e[0]?e[0]:1,t.isLoading=!0,t.currentPage=n,c="\n        ".concat("https://vue3-course-api.hexschool.io","/api/").concat("ccok-api","/admin/coupons?page=").concat(n,"\n      "),o.next=6,fetch(c,{headers:{Authorization:t.tokenValue}});case 6:return a=o.sent,o.next=9,a.json();case 9:l=o.sent,t.coupons=l.coupons,t.pagination=l.pagination,t.isLoading=!1;case 13:case"end":return o.stop()}}),o)})))()},openModal:function(e,t){this.isNew=e,this.tempCoupon=e?{}:Object(V["a"])({},t),this.$refs.couponModal.showModal()},updateCoupon:function(e){var t=this;return Object(E["a"])(regeneratorRuntime.mark((function o(){var n,c,a,l,r,i;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return t.$refs.couponModal.hideModal(),t.isNew?(n="\n          ".concat("https://vue3-course-api.hexschool.io","/api/").concat("ccok-api","/admin/coupon\n        "),c="post",a=1):(n="\n          ".concat("https://vue3-course-api.hexschool.io","/api/").concat("ccok-api","/admin/coupon/").concat(e.id,"\n        "),c="put",a=t.currentPage),l={data:Object(V["a"])({},e)},o.prev=3,o.next=6,fetch(n,{method:c,headers:{Authorization:t.tokenValue,"Content-Type":"application/json"},body:JSON.stringify(l)});case 6:return r=o.sent,o.next=9,r.json();case 9:i=o.sent,t.getCoupons(a),t.pushToast(i,"優惠卷"),o.next=17;break;case 14:o.prev=14,o.t0=o["catch"](3),console.error(o.t0);case 17:t.isNew=!1;case 18:case"end":return o.stop()}}),o,null,[[3,14]])})))()},checkDelete:function(e){this.tempCoupon=Object(V["a"])({},e),this.$refs.deleteModal.showModal()},delCoupon:function(e){var t=this;return Object(E["a"])(regeneratorRuntime.mark((function o(){var n,c,a;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return t.$refs.deleteModal.hideModal(),n="\n        ".concat("https://vue3-course-api.hexschool.io","/api/").concat("ccok-api","/admin/coupon/").concat(e.id,"\n      "),o.next=4,fetch(n,{method:"delete",headers:{Authorization:t.tokenValue}});case 4:return c=o.sent,o.next=7,c.json();case 7:a=o.sent,t.pushToast(a,"優惠卷"),a.success&&t.getCoupons(t.currentPage);case 10:case"end":return o.stop()}}),o)})))()}},created:function(){this.getCoupons()}};const ce=Z()(ne,[["render",f]]);t["default"]=ce}}]);
//# sourceMappingURL=chunk-2d22c48a.a4d7b79f.js.map